#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Pre-commit hook for code quality and consistency
# Runs type checking, linting, formatting, and tests before commits

echo "ğŸ” Running pre-commit checks..."

# Type checking
echo "ğŸ“ Type checking..."
npm run typecheck
if [ $? -ne 0 ]; then
  echo "âŒ Type check failed. Please fix type errors before committing."
  exit 1
fi

# Code formatting
echo "ğŸ¨ Formatting code..."
npm run format
if [ $? -ne 0 ]; then
  echo "âŒ Code formatting failed. Please check Prettier configuration."
  exit 1
fi

# Linting (if available)
echo "ğŸ” Linting code..."
if npm run lint --silent 2>/dev/null; then
  npm run lint
  if [ $? -ne 0 ]; then
    echo "âŒ Linting failed. Please fix lint errors before committing."
    exit 1
  fi
else
  echo "âš ï¸  Linting not configured, skipping..."
fi

# Run tests
echo "ğŸ§ª Running tests..."
npm run test:ci
if [ $? -ne 0 ]; then
  echo "âŒ Tests failed. Please fix failing tests before committing."
  exit 1
fi

# Add formatted files to staging
echo "ğŸ“¦ Adding formatted files to staging..."
git add .

echo "âœ… All pre-commit checks passed!"